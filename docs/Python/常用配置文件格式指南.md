# 常用配置文件格式指南

常见的配置文件有 `ini`、`toml`、`yaml` 格式。`toml` 是个比较年轻的格式。

## `ini` 配置文件

参考：python [`configparser`](https://docs.python.org/zh-cn/3/library/configparser.html) 模块

* 结构简单
* 不支持二级分部
* 仅支持字符串格式，需要其他数据格式，需要自行转换

一个常见的 `ini` 配置文件：

```ini
# example.ini
[DEFAULT]
ServerAliveInterval = 45
Compression = yes
CompressionLevel = 9
ForwardX11 = yes

[bitbucket.org]
User = hg

[topsecret.server.com]
Port = 50022
ForwardX11 = no
```

python 读取 `ini` 配置文件：

```python
import configparser
config = configparser.ConfigParser()
config.read('example.ini')

ServerAliveInterval = config.get('DEFAULT', 'ServerAliveInterval')
```

## `toml` 配置文件

参考：[toml 官方文档](https://toml.io/cn/) 、python [`tomllib`](https://docs.python.org/zh-cn/3/library/tomllib.html#module-tomllib) 模块

为人而生的配置文件格式。

TOML 旨在成为一个语义明显且易于阅读的最小化配置文件格式。TOML 被设计成可以无歧义地映射为哈希表。TOML 应该能很容易地被解析成各种语言中的数据结构。

全称：Tom 的（语义）明显、（配置）最小化的语言。（Tom's Obvious, Minimal Language）
作者：Tom Preston-Werner、Pradyun Gedam 等人。

* TOML 是大小写敏感的。
* TOML 文件必须是合法的 UTF-8 编码的 Unicode 文档。
* 空白是指制表符（0x09）或空格（0x20）。
* 换行是指 LF（0x0A）或 CRLF（0x0D0A）。
* TOML 文件应当使用 `.toml` 扩展名。
* 在互联网上传输 TOML 文件时，恰当的 MIME 类型是 `application/toml`。

>**注意：**
>
>**裸键** key 只能包含 ASCII 字母，ASCII 数字，下划线和短横线（`A-Za-z0-9_-`），不支持中文。

### 基本语法

```toml
# example.toml
# 这是一个全行注释
[table]
key1 = "some string"  # 字符串，这是一个行末注释
key2 = 123  # 整数
flt2 = 3.1415  # 浮点数
bool1 = true  # 布尔值，要小写
odt1 = 1979-05-27T07:32:00Z  # UTC 时间
odt2 = 1979-05-27T00:32:00+08:00  # 东八区时间
odt3 = 1979-05-27 07:32:00.999999  # 无时区信息，可以用一个空格字符替代日期和时刻之间的 T
ld1 = 1979-05-27  # 日期
lt2 = 00:32:00.999999  # 时刻
colors = [  # 数组，可以列表、字典
  "Foo Bar <foo@example.com>",
  { name = "Baz Qux", email = "bazqux@example.com", url = "https://example.com/bazqux" }
]

[fruits.physical]  # 子表
color = "red"

[[products]]  # 表数组
name = "Hammer"

[[fruits.varieties]]  # 嵌套表数组
name = "red delicious"
```

### 字符串

```toml
[table]
key1 = "some string"  # 基本字符串由双引号 "" 双引号包裹

# 多行基本字符串由三个引号包裹，允许折行。
# 紧随开头引号的那个换行会被去除。其它空白和换行会被原样保留。
str1 = """
Roses are red
Violets are blue"""

# 字面量字符串（即 raw 字符串）由单引号 ' 包裹。
# 所见即所得。
winpath  = 'C:\Users\nodejs\templates'
winpath2 = '\\ServerX\admin$\system32\'
quoted   = 'Tom "Dubs" Preston-Werner'
regex    = '<\i\c*\s*>'

# 多行字面量字符串两侧各有三个单引号来包裹，允许换行。
lines  = '''
原始字符串中的
第一个换行被剔除了。
   所有其它空白
   都保留了。
'''
```

python 读取 `toml` 配置文件。python3.11+ 内置了 `tomllib` 标准库（从 `tomli` 库移植而来）。

```python
import tomllib
from pathlib import Path

toml_str = Path('example.toml').read_text()
data = tomllib.loads(toml_str)

# 如果 python 版本小于 3.11，使用以下方法
try:
    import tomllib
except ModuleNotFoundError:
    import tomli as tomllib
```

> 注意：
>
> tomllib 标准库仅支持读取操作，不支持写入操作，写入可以考虑使用 [**`tomli-w`**](https://pypi.org/project/tomli-w/) 或 [**`tomlkit`**](https://pypi.org/project/tomlkit/) 。

## `yaml` 配置文件

参考：[yaml 官方文档](https://yaml.org/)

基本语法

* 大小写敏感
* 使用缩进表示层级关系
* 缩进不允许使用 tab，只允许空格
* 缩进的空格数不重要，只要相同层级的元素左对齐即可
* `#` 表示注释
* 扩展名使用 `.yml` 或 `.yaml`

```yaml
# example.yml
key:
    child-key: value  # 冒号后面要加一个空格，使用缩进表示层级关系

companies:
    -             # 以 - 开头的行表示构成一个数组
        id: 1
        name: company1
        price: 200W
    -
        id: 2
        name: company2
        price: 500W
```

python 读取 `yaml` 文件，需要使用 `pyyaml` 库（仅支持到 `yaml 1.1` 标准），或者使用 `ruamel.yaml` 库（支持最新的 `yaml 1.2` 标准）。
