# Excel VBA 学习总结 - 基础知识

## 1.什么是 VBA？

  当前辈们使用 Excel 的时候，他们惊奇的发现：Excel 那是相当的彪悍，几乎任何的数据分析与处理，它都可以"近乎完美"(实际上不可能完美) 完成。但是在使用的过程中，他们也同样发现，有很多工作是要重复做的。如果要想自动重复的完成这些工作，必须要借助其他的编程语言和工具。微软为了简化这个过程，开发了一个通用的自动化语言，这个就是 VBA(Visual Basic for Application)。所有支持 VBA 的应用程序都可以方便的自动化执行某些固定的步骤，除此以外，支持 VBA 的应用程序之间也可以通过 VBA 这个平台进行互操作。由于这里讨论的是 Excel 中的 VBA，所以我后面的总结内容都是以 Excel 中的 VBA 为主。

  VBA 是 VB 的一个子集，它们之间有些地方是不同的：

VB 程序可以独立的部署和运行，但是 VBA 程序不能离开宿主程序运行。VB 程序是一个编译型的语言，程序需要编译后执行，而 VBA 程序是解释执行的脚本语言。通过 VBA 这个工具，Excel 就可以完成许多自动化的任务，并且可以充分利用 Office 其它组件的功能。

## 2.VBA 能做什么？

  知道了 VBA 是什么东东后，那么它能干什么呢？确定的说，VBA 基本能做一切 Excel 能做的事，比如打印，生成报表，分析数据，生成图表等，这是 VBA 最大的优点。不需要额外实现这些标准的功能，只需要简单的调用就可以了，Excel 已经做好了一切准备。除了这个好处，VBA 其实还能处理很多的任务：

* 自定义 Excel 的外观，菜单，工具栏等。
* 重复执行自动化操作。
* 操作文件和文件夹
* 访问数据库并执行相关操作
* 访问网络
* 操作 XML
* 获取系统信息
* 操作和自动化 Office 其它组件 (支持 VBA 的其他公司的产品也可以操作)

除了上述的任务外，VBA 还有很多其它的功能有待发掘。

## VBA 与 Macro

  Macro 是一组 Excel 能理解并执行的命令集合。借助宏录制器，我们能得到这些宏命令翻译后的 VBA 代码。这是最简洁获得 VBA 代码的方式，也是 VBA 开发最主要的模式。

### VBA 小结

  VBA 的语法很简单，这里就不再详述了。我个人学习新语言的习惯都是，先了解一下这个语言出现的背景，然后了解一下语言改进的地方，最后是实践一下基本的语法，研究语言运行的机制和部署情况。经过这个步骤以后，我就做几个实际小例子巩固巩固。我学习 VBA 的小结如下：

Module 是 VBA 组织代码的最小单元。
VBA 是不分大小写的，所以更要养成良好的编程习惯。
代码可以一行写多句，用":"隔开，也可以一句写在多行，行末用"_"标识。
Module 成员的访问限定：
    Public: 当前程序中的所有模块都可以访问该成员，如果方法默认不加限定符的话，当 Public 处理；Public 成员只能在 Module 中定义。

    Dim/Private:只有本 Module 内部的所有方法才能访问这些成员。当然方法是不能用 Dim 定义的。

    Friend：只能用于对象模块或者窗体模块，作用范围是当前程序中的其他对象模块可以访问该成员。

Const 定义恒定变量的时候，只能在 Module 中定义，不能在方法内定义；前面可以加 Public/Private 限定。

有一点比较恶心，对象赋值用"Set...="，其余的一切赋值用"="，包括对象的属性赋值。

可以使用 Type 在模块级别中定义包含一个或多个元素的用户自定义的数据类型。

根据使用情况 (比如需要的存储大小) 选用合适的变量类型，一般都应该明确定义变量类型，不要使用默认的 Variant 类型。

当需要使用变长集合的时候，可以考虑使用动态数组 (使用 ReDim 和 Preserve)。

Nothing、Empty 与 Null 的比较：

    Nothing：这是一个指向空对象的对象引用。将对象引用设置为 Nothing，就释放了那个对象。如果没有其他的引用指向对象，VB/VBA 就将销毁这个对象。可以使用“Obj is Nothing”的方式检查。

    Empty：这是一个象 Integer 或者 String 一样的变量类型，它表示了一个还没有进行初始化的变量。它与 Null 的意义不同，Null 表示没有合法数据。例如数组，集合刚定义，还没有赋值之前就是这个状态，可以使用内置方法 IsEmpty 检查。

    Null：这是一个象 Integer 或者 String 一样的变量类型，它表示一个没有合法数据的变量。这有别于 zero、Nothing、Empty 或者 vbNullString。Null 参与的运算，都将产生 Null 结果。可以用内置方法 IsNull 检查。

使用"For Each"语句枚举集合成员。

使用"For"语句执行固定次数的循环。

使用"Do While/Until...Loop"或者"While...Wend"语句执行不定次数的循环。

使用"If"语句执行 2 分支的选择。

使用"Switch Case"语句执行 n 分支的选择。

使用"With"语句减少重复对象的书写。

在 Module 开始的时候，加上"Option Explicit"可以强制变量使用前必须声明。

类型定义的简短写法：

例如定义整形，可简写为：Dim i%

>Integer %
>Long &
>Single !
>Double #
>Currency @
>String $
>String *
>size $

方法调用可以加括号，也可以不加括号；如果要是加括号，特别是含有多个参数的时候，则前面需要加上"Call"。

方法是支持可选参数的，参数前用"Optional"标识并用"="提供默认值。可选参数用"参数名:=值"的方式传值特别方便。

连接多个变量时，尽量使用强制连接符"&"，少使用混和连接符"+"。

在合适的时候，尽量多使用位操作 (XOR,OR,AND,NOT) 等完成多个 Boolean 类型的相关判断与操作，而不是直接使用"IF"判断。

最重要的两点：当你不知道如何下手的时候，请尝试录一个宏看看；批判吸收多个人的知识，并不是所有写出来的都是对的，实践是检验真理的唯一标准。
