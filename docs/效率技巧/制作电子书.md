# 制作 epub 格式电子书

参考：<https://pandoc.org/MANUAL.html#epubs>

<https://pandoc.org/epub.html>

epub 格式本身是一个开放的电子书格式，使用 `pandoc` 很容易制作 epub 格式的电子书。

安装 pandoc

```sh
scoop install pandoc
```

## 创建 Markdown 格式的文本

创建 `test.md` ，使用 Markdown 格式编写电子书，内容如下：

```markdown
---
title: 鹿鼎记
author: 金庸
lang: zh-CN
---

# 第一回 纵横钩党清流祸 峭茜风期月旦评

  北风如刀，满地冰霜。

  江南近海滨的一条大路上，一队清兵手执刀枪，押着七辆囚车，冲风冒寒，向北而行。

    ...

# 第二回 绝世奇事传闻里 最好交情见面初

  扬州城自古为繁华胜地，唐时杜牧有诗云：“十年一觉扬州梦，赢得青楼薄幸名。”古人云人生乐事，莫过于“腰缠十万贯，骑鹤上扬州。”自隋炀帝开凿运河，扬州地居运河之中，为苏浙漕运必经之地。明清之季，又为盐商大贾所聚居，殷富甲于天下。
  
  ...
```

说明：

>上面是 YAML metadata block，参考：<https://pandoc.org/MANUAL.html#epubs>
>
>`lang: zh-CN` 设置为中文，使用 iBook 时，选择字体时是中文字体选项，不设置的话全是英文字体选项。

## 使用 pandoc 生成 epub 格式电子书

准备好电子书的封面照片 `cover.jpg` ，使用以下命令创建 epub 格式电子书：

```sh
pandoc test.md --epub-cover-image="cover.jpg" -o "test.epub"
```

设置字体等其它高级设置，参考 pandoc 使用说明。

批量制作电子书：

```sh
@echo off

if not exist epub md epub
for %%i in (md\*.md) do (
 echo "md\%%~ni.jpg"
 if exist "md\%%~ni.jpg" (
  pandoc "%%i" --epub-cover-image="md\%%~ni.jpg" -o ".\epub\%%~ni.epub"
  echo  "转换成功 %%i"
 ) else (
  pandoc "%%i" -o ".\epub\%%~ni.epub"
  echo "转换成功 %%i"
 )
)
echo 转换结束！
pause

rem pandoc  "天龙八部.md" --epub-cover-image="cover.jpg" -o "天龙八部.epub"
```
